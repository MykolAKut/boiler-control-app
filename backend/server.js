// =================================================================
//                      –ì–û–õ–û–í–ù–ò–ô –§–ê–ô–õ –°–ï–†–í–ï–†–ê
// =================================================================

// 1. –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –∑–º—ñ–Ω–Ω–∏—Ö —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ –∑ —Ñ–∞–π–ª—É .env
require('dotenv').config();

// 2. –Ü–º–ø–æ—Ä—Ç –±–∞–∑–æ–≤–∏—Ö –º–æ–¥—É–ª—ñ–≤
const express = require('express');
const http = require('http');
const cors = require('cors');
const path = require('path'); // <-- –î–æ–¥–∞–Ω–æ –º–æ–¥—É–ª—å path –¥–ª—è –Ω–∞–¥—ñ–π–Ω–æ—ó —Ä–æ–±–æ—Ç–∏ –∑—ñ —à–ª—è—Ö–∞–º–∏

// 3. –Ü–º–ø–æ—Ä—Ç –∫–∞—Å—Ç–æ–º–Ω–∏—Ö –º–æ–¥—É–ª—ñ–≤ –Ω–∞—à–æ—ó –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏
// –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ path.join –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∞–±—Å–æ–ª—é—Ç–Ω–∏—Ö —à–ª—è—Ö—ñ–≤, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –ø–æ–º–∏–ª–æ–∫
const boilerRoutes = require(path.join(__dirname, 'routes', 'boilerRoutes'));
const simulationService = require(path.join(__dirname, 'logic', 'boilerSimulation'));

// 4. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è Express-–¥–æ–¥–∞—Ç–∫—É
const app = express();
const server = http.createServer(app);

// Middleware –¥–ª—è –æ–±—Ä–æ–±–∫–∏ CORS –∑–∞–ø–∏—Ç—ñ–≤ —Ç–∞ JSON —Ç—ñ–ª
app.use(cors());
app.use(express.json());

// 5. –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –º–∞—Ä—à—Ä—É—Ç—ñ–≤ API
// –£—Å—ñ –∑–∞–ø–∏—Ç–∏, —â–æ –ø–æ—á–∏–Ω–∞—é—Ç—å—Å—è –∑ /api/boiler, –±—É–¥—É—Ç—å –æ–±—Ä–æ–±–ª—è—Ç–∏—Å—è —É boilerRoutes
app.use('/api/boiler', boilerRoutes);

// 6. –ó–∞–ø—É—Å–∫ —Ñ–æ–Ω–æ–≤–æ—ó —Å–∏–º—É–ª—è—Ü—ñ—ó –∫–æ—Ç–ª–∞
// –¶—è —Ñ—É–Ω–∫—Ü—ñ—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞, –∞–ª–µ –Ω–∞–º –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ —á–µ–∫–∞—Ç–∏ —ó—ó –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Ç—É—Ç
simulationService.startSimulation();

// 7. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
const PORT = process.env.PORT || 8080;
server.listen(PORT, () => {
    console.log(`üöÄ –ë–µ–∫–µ–Ω–¥-—Å–µ—Ä–≤–µ—Ä —É—Å–ø—ñ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω–æ –Ω–∞ –ø–æ—Ä—Ç—ñ ${PORT}`);
    console.log(`–°—Ç—Ä—É–∫—Ç—É—Ä–∞ API –¥–æ—Å—Ç—É–ø–Ω–∞ –∑–∞ –∞–¥—Ä–µ—Å–æ—é http://localhost:${PORT}/api/boiler`);
});
